# 14

LCR 131. 砍竹子 I  

## 题目描述

bamboo_len: int 竹子长度  

要求：  
将竹子砍成若干正整数长度段  

返回：  
子段长度之积  

## 思路

尽量使得分布平均  

## 证明

结论“尽量使得分布平均可以使乘积最大”的数学基础包括均值不等式（AM-GM）与连续优化（并据此进行整数离散化）。

### 1) 固定段数下的最优：AM-GM 不等式

设把总长度 $n$ 切成 $k$ 段，段长为非负数 $x_1,\dots,x_k$，满足 $x_1+\cdots+x_k=n$。AM-GM 告诉我们：

$$
\frac{x_1+\cdots+x_k}{k} \ge \sqrt[k]{x_1\cdots x_k}\,\,\,\text{，且当且仅当 } x_1=\cdots=x_k \text{ 时取等号。}
$$

因此在“段数 $k$ 固定”的前提下，乘积 $x_1\cdots x_k$ 在各段尽量相等（$x_i=\frac{n}{k}$）时达到最大，对应的最大乘积为

$$
P(k) = \left(\frac{n}{k}\right)^k.
$$

### 2) 连续最优的段数选择：对 $k$ 做优化

将 $k$ 暂视为连续变量，最大化 $P(k)$ 等价于最大化其对数：

$$
\ln P(k) = k\,\ln\!\left(\frac{n}{k}\right) = k\ln n - k\ln k.
$$

对 $k$ 求导并令零：

$$
\frac{\mathrm{d}}{\mathrm{d}k}\big(k\ln n - k\ln k\big) = \ln n - \ln k - 1 = 0 \;\Rightarrow\; k = \frac{n}{e}.
$$

于是连续最优对应的“理想段长”是

$$
x = \frac{n}{k} = \frac{n}{n/e} \approx e \approx 2.718.
$$

直观地说：每一段的长度如果都接近常数 $e$，乘积最大。

### 3) 离散化到整数：优先用 3，必要时用 2

实际题目要求段长为整数。由上面的连续最优可知，整数上应选择接近 $e$ 的值，即 2 或 3。进一步做局部比较：

- 固定总和 6 时，$3+3$ 的乘积 $9$ 优于 $2+2+2$ 的乘积 $8$；说明更偏好 3。
- 不能出现 1，因为 $3\times 1 = 3 < 2\times 2 = 4$；当余数为 1 时，要用 $2+2$ 代替 $3+1$。

因此最优整数拆分策略为：

- $n\bmod 3=0$：全部拆成 3；乘积为 $3^{n/3}$。
- $n\bmod 3=1$：将一个 $3+1$ 改成 $2+2$，即先拆成 $(n-4)$ 的若干个 3，再补两个 2；乘积为 $3^{(n-4)/3}\cdot 2^2$。
- $n\bmod 3=2$：拆成若干个 3，再加一个 2；乘积为 $3^{\lfloor n/3\rfloor}\cdot 2$。

### 4) 边界情况

当 $n\le 3$ 时，整数拆分的最优值按“必须拆分为至少两段”的约定处理：

- $n=2 \Rightarrow 1\times 1 = 1$。
- $n=3 \Rightarrow 2\times 1 = 2$。

### 5) 结论与实现提示

“尽量平均”在数学上由 AM-GM 保证；连续最优指向每段长度接近 $e$；离散化后在整数上选择尽可能多的 3，并在余数为 1 时用 $2+2$ 替代 $3+1$，余数为 2 时加一个 2。实现上可直接用贪心：

- 不断取 3，直到剩余长度小于等于 4；
- 对剩余长度 2 或 4 用 2 处理；
- 乘积按 $3^a\cdot 2^b$ 计算即可（可考虑取模）。
